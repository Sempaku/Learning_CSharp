# Валидация модели
Большую роль в приложении играет валидация модели или проверка вводимых данных на корректность. Например, у нас есть класс пользователя, в котором определено свойство для хранения возраста. И нам было бы нежелательно, чтобы пользователь вводил какое-либо отрицательное число или заведомо невозможный возвраст, например, миллион лет.

```C#
public class User
{
    public string Name { get; set; }
    public int Age { get; set; }
 
    public User(string name, int age)
    {
        Name = name;
        Age = age;
    }
}
```
В программе мы можем проверять вводимые данные с помощью условных конструкций:

```C#
CreateUser("Tom", 37);
CreateUser("b", -4);
CreateUser("", 130);
 
void CreateUser(string name, int age)
{
    User user = new User(name, age);
    // проверяем корректность значения свойства Name
    // если его длина в диапазоне от 3 до 50, то оно корректно
    if (user.Name.Length >= 3 && user.Name.Length <= 50)
        Console.WriteLine($"Name: {user.Name}");
    else
        Console.WriteLine("Incorrect name!");
 
    // проверяем корректность значения свойства Age
    // если оно в диапазоне от 1 до 100, то оно корректно
    if (age >= 1 && age <= 100)
        Console.WriteLine($"Age: {user.Age}\n");
    else
        Console.WriteLine("Incorrect age!\n");
 
}
public class User
{
    public string Name { get; set; }
    public int Age { get; set; }
 
    public User(string name, int age)
    {
        Name = name;
        Age = age;
    }
}
```

# Атрибуты валидации
Для валидации модели мы можем использовать большой набор встроенных атрибутов. Все эти атрибуты представляют классы, унаследованные от класса ValidationAttribute

Имеется довольно большое количество атрибутов. Основные из них:

- Required: данный атрибут указывает, что свойство должно быть обязательно установлено, обязательно должно иметь какое-либо значение. Если свойство имеет значение null, то оно не проходит валидацию. Также не проходят валидацию свойства, которые представляют тип string, и которым присваивается пустая строка. Из его свойств следует отметить свойство AllowEmptyStrings. Если оно имеет значение true, то для строковых свойств разрешено использовать пустые строки:

- RegularExpression: указывает на регулярное выражение, которому должно соответствовать значение свойства. 
- StringLength: определяет допустимую длину для строковых свойств. В качестве первого параметра он принимает максимально допустимую длину строки. С помощью дополнительного свойства MinimumLength можно установить минимально допустимую длину строки
- Range: задает диапазон допустимых числовых значений. В качестве первых двух параметров он принимает минимальное и максимальное значения:
- Compare: позволяет сравнить значение текущего свойства со значением другого свойства, которое передается в этот атрибут.
- Phone: данный атрибут автоматически валидирует значение свойства, является ли оно телефонным номером. Фактически это встроенная альтернатива использованию регулярного выражения, как было показано выше
- EmailAddress: определяет, является ли значение свойства электронным адресом
- CreditCard: определяет, является ли значение свойства номером кредитной карты
- Url: определяет, является ли значение свойства гиперссылкой


## Настройка сообщения об ошибке
Класс ValidationAttribute определяет для атрибутов ряд общих свойств и методов, из которых следует выделить свойство ErrorMessage. Это свойство позволяет задать сообщение обошибке.

```C#
[Required(ErrorMessage = "Не указано имя пользователя")]
[StringLength(50, MinimumLength = 3, ErrorMessage = "Недопустимая длина имени")]
public string Name { get; set; }
```

## Передача в сообщение об ошибке аргументов
Ряд атрибутов с помощью свойств могут принимать различные параметры. И эти параметры можно использовать в сообщении об ошибке
```C#
using System.ComponentModel.DataAnnotations;
 
CreateUser("T", 120);
 
void CreateUser(string name, int age)
{
    User user = new User(name, age);
    var results = new List<ValidationResult>();
    var context = new ValidationContext(user);
    if (!Validator.TryValidateObject(user, context, results, true))
    {
        foreach (var error in results)
        {
            Console.WriteLine(error.ErrorMessage);
        }
    }
}
public class User
{
    [Required(ErrorMessage = "Не указано имя пользователя")]
    [StringLength(50, MinimumLength = 3, ErrorMessage = "Длина имени должна быть в диапазоне от {2}-{1} символов")]
    public string Name { get; set; }
 
    [Range(1, 100, ErrorMessage = "Возраст должен быть в диапазоне {1}-{2}")]
    public int Age { get; set; }
 
    public User(string name, int age)
    {
        Name = name;
        Age = age;
    }
}
```
В сообщение об ошибке с помощью плейсхолдеров {0}, {1}, {2} и т.д. можно передавать параметры атрибута. Параметр {0} в любом атрибуте представляет имя свойства, которое валидируется. То есть в данном случае это было бы "Name". {1} здесь - первый параметр атрибута - максимальное количество символов - 50. {2} - второй параметр - значение свойства MinimumLength. То есть в итоге сформируется сообщение Длина имени должна быть в диапазоне от 3-50 символов

Здесь параметр {0} представлял бы имя свойства - "Age". {1} здесь - первый параметр атрибута - минимальное значение - 1. {2} - максимальное значение 100.



